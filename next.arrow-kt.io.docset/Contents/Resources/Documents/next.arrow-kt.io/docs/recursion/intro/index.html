<!DOCTYPE html><html><head>
    <meta charset="UTF-8"/>
    <a class="dashingAutolink" name="autolink-11512"></a><a class="dashAnchor" name="//apple_ref/cpp/Package/Arrow"></a><title>Arrow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Functional companion to Kotlin&#39;s Standard Library"/>
    <meta name="keywords" content="functional-programming, kotlin-library, monads, monad-transformers, functional-data-structure, kotlin, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory"/>

    <meta property="og:image" content="http://arrow-kt.io/img/poster.png"/>
    <meta property="og:title" content="Arrow"/>
    <meta property="og:site_name" content="Arrow"/>
    <meta property="og:url" content="http://arrow-kt.io/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:description" content="Functional companion to Kotlin&#39;s Standard Library"/>
    <meta property="og:keywords" content="functional-programming, kotlin-library, monads, monad-transformers, functional-data-structure, kotlin, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory"/>

    <meta name="twitter:text:description" content="Functional companion to Kotlin&#39;s Standard Library"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@arrow_kt"/>
    <meta name="twitter:creator" content="@arrow_kt"/>
    <meta name="twitter:image" content="http://arrow-kt.io/img/twitter-card.png"/>

    <!-- Arrow versions metadata -->
    <meta name="previous-version" data-title="" data-url=""/>
    <meta name="stable-version" data-title="" data-url=""/>
    <meta name="next-version" data-title="" data-url=""/>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet" type="text/css"/>
    <!-- Animated -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"/>
    <!-- Arrow main css -->
    <link rel="shortcut icon" href="../../../img/favicon.png"/>
    <!-- highlight  css -->
    <link rel="stylesheet" type="text/css" href="../../../css/highlight/atom-one-light.css"/>
    <!-- Arrow main css -->
    <link rel="stylesheet" type="text/css" href="../../../css/arrow.css"/>

    <!-- Code to manage version information -->
    <script src="../../../js/docVersions.js" defer=""></script>

    <!-- Diagrams support -->
    <script src="../../../js/dagre.min.js"></script>
    <script src="../../../js/lodash.min.js"></script>
    <script src="../../../js/nomnoml.js"></script>
    <script src="../../../js/diagrams.js" async=""></script>

    
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-18433785-18"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-18433785-18');
</script>

    
</head>

<body id="doc-body">
<div id="wrapper">
    <div id="sidebar-wrapper">
    <div class="sidebar-brand">
        <a class="brand" href="https://next.arrow-kt.io/">
            <img src="../../../img/arrow-brand-sidebar.svg" alt=""/>
            <span>&Lambda;rrow</span>
        </a>
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <span class="close"></span>
        </button>
    </div>

    <ul class="sidebar-nav sidebar-doc-versions">
  <li class="sidebar-nav-item">
    <a href="index.html#">
      <span>Arrow version</span>
      <span id="arrow-version"></span>
    </a>
    <ul>
      <li>
        <a href="https://arrow-kt.io/docs/">
          <span>
            v0.9.0 - STABLE
          </span>
        </a>
      </li>

      <li>
        <a href="../../index.html">
            <span>
              v0.9.1 - NEXT
            </span>
        </a>
      </li>

      <li>
        <a href="https://0-8-2.arrow-kt.io/docs/">
            <span>
              v0.8.2 -
              PREVIOUS
            </span>
        </a>
      </li>

      
        
      
        
      
        
      
    </ul>
  </li>
</ul>


    <ul class="sidebar-nav">
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Quick Start</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../index.html">
                        <i class="fa fa-circle"></i>
                        <span>Index</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../quickstart/libraries/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Libraries</span>
                    </a>
                </li>
                
                <li>
                    <a href="https://next.arrow-kt.io/blog/">
                        <i class="fa fa-circle"></i>
                        <span>Blogs &amp; Presentations</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../quickstart/projects/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Projects &amp; Examples</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Arrow Fx</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../effects/fx/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Getting Started</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/fx/async/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Asynchronous &amp; Concurrent Programming</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/fx/polymorphism/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Polymorphism. One Program multiple runtimes</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>API Docs</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../apidocs/arrow-typeclasses/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Type Classes</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-core-data/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Core Data Types</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-core-extensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Core Extensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-extras/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Core Extra Data Types</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-extras-extensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Core Extra Extensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-data/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-extensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects Extensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-kotlinx-coroutines-data/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects Coroutines</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-kotlinx-coroutines-extensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects Coroutines Extensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-rx2-data/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects Rx2</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-rx2-extensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects Rx2 Extensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-reactor-data/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects Reactor</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-reactor-extensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effects Reactor Extensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-streams/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Streams</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-mtl/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MTL</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-optics/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Optics</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-recursion-data/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Recursion</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-recursion-extensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Recursion Extensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-generic/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Generic</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-free-data/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Free</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-validation/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Validation</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Patterns</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../patterns/glossary/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Glossary</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../patterns/error_handling/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Error Handling</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../patterns/dependency_injection/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Dependency Injection</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../patterns/monads/index.html">
                        <i class="fa fa-circle"></i>
                        <span>The Monad Tutorial</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../patterns/monad_comprehensions/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Monad Comprehensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../patterns/polymorphic_programs/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Polymorphic Programs</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../patterns/free_algebras/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Free Algebras</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Data Types</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../datatypes/intro/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Intro</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../datatypes/basic/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Basic Types</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/core/option/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Option</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/core/either/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Either</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/core/try/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Try</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/validated/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Validated</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/nonemptylist/index.html">
                        <i class="fa fa-circle"></i>
                        <span>NonEmptyList</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/listk/index.html">
                        <i class="fa fa-circle"></i>
                        <span>ListK</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/sequencek/index.html">
                        <i class="fa fa-circle"></i>
                        <span>SequenceK</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/setk/index.html">
                        <i class="fa fa-circle"></i>
                        <span>SetK</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/mapk/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MapK</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/sortedmapk/index.html">
                        <i class="fa fa-circle"></i>
                        <span>SortedMapK</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/ior/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Ior</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/core/id/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Id</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/reader/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Reader</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/kleisli/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Kleisli</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/state/index.html">
                        <i class="fa fa-circle"></i>
                        <span>State</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/statet/index.html">
                        <i class="fa fa-circle"></i>
                        <span>StateT</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/store/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Store</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/moore/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Moore</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/sum/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Sum</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/day/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Day</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/writert/index.html">
                        <i class="fa fa-circle"></i>
                        <span>WriterT</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/free/trampoline/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Trampoline</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/coproduct/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Coproduct</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/core/eval/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Eval</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/optiont/index.html">
                        <i class="fa fa-circle"></i>
                        <span>OptionT</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/data/eithert/index.html">
                        <i class="fa fa-circle"></i>
                        <span>EitherT</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/core/function0/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Function0</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/core/function1/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Function1</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/const/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Const</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Type Classes</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../typeclasses/intro/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Intro</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/show/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Show</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/eq/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Eq</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/hash/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Hash</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/order/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Order</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/semigroup/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Semigroup</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-typeclasses/arrow.typeclasses/-semigroupal/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Semigroupal</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-typeclasses/arrow.typeclasses/-monoidal/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Monoidal</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/monoid/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Monoid</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-typeclasses/arrow.typeclasses/-semiring/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Semiring</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/foldable/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Foldable</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/bifoldable/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Bifoldable</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/traverse/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Traverse</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/reducible/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Reducible</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/mtl/typeclasses/traversefilter/index.html">
                        <i class="fa fa-circle"></i>
                        <span>TraverseFilter</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/functor/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Functor</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/mtl/typeclasses/functorfilter/index.html">
                        <i class="fa fa-circle"></i>
                        <span>FunctorFilter</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/applicative/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Applicative</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/applicativeerror/index.html">
                        <i class="fa fa-circle"></i>
                        <span>ApplicativeError</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/selective/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Selective</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/monad/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Monad</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/monaderror/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonadError</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/effects/typeclasses/bracket/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Bracket</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/mtl/typeclasses/monadfilter/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonadFilter</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/mtl/typeclasses/monadreader/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonadReader</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/mtl/typeclasses/monadwriter/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonadWriter</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/mtl/typeclasses/monadstate/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonadState</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/mtl/typeclasses/monadcombine/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonadCombine</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/comonad/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Comonad</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/bimonad/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Bimonad</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/bifunctor/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Bifunctor</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/profunctor/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Profunctor</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/semigroupk/index.html">
                        <i class="fa fa-circle"></i>
                        <span>SemigroupK</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/monoidk/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonoidK</span>
                    </a>
                </li>
                
                <li>
                    <a href="https://next.arrow-kt.io/docs/typeclasses/inject/">
                        <i class="fa fa-circle"></i>
                        <span>Inject</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/alternative/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Alternative</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/divide/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Divide</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/divisible/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Divisible</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../arrow/typeclasses/decidable/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Decidable</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Effects</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../effects/io/index.html">
                        <i class="fa fa-circle"></i>
                        <span>IO</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/monaddefer/index.html">
                        <i class="fa fa-circle"></i>
                        <span>MonadDefer</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/async/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Async</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/effect/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Effect</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/promise/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Promise</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/ref/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Ref</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../effects/fiber/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Fiber</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../apidocs/arrow-effects-data/arrow.effects/-resource/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Resource</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Optics</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../optics/dsl/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Optics DSL</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/iso/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Iso</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/lens/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Lens</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/optional/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Optional</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/prism/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Prism</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/getter/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Getter</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/setter/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Setter</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/fold/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Fold</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/traversal/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Traversal</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/cons/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Cons</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/snoc/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Snoc</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/at/index.html">
                        <i class="fa fa-circle"></i>
                        <span>At</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/index/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Index</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/filterindex/index.html">
                        <i class="fa fa-circle"></i>
                        <span>FilterIndex</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../optics/each/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Each</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>&Lambda;rrow Query Language</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../aql/intro/index.html">
                        <i class="fa fa-circle"></i>
                        <span>&Lambda;rrow Query Language</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/select/index.html">
                        <i class="fa fa-circle"></i>
                        <span>select</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/from/index.html">
                        <i class="fa fa-circle"></i>
                        <span>from</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/where/index.html">
                        <i class="fa fa-circle"></i>
                        <span>where</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/groupby/index.html">
                        <i class="fa fa-circle"></i>
                        <span>groupBy</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/orderby/index.html">
                        <i class="fa fa-circle"></i>
                        <span>orderBy</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/sum/index.html">
                        <i class="fa fa-circle"></i>
                        <span>sum</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/union/index.html">
                        <i class="fa fa-circle"></i>
                        <span>union</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../aql/custom/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Custom Data Types</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Generic</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../generic/coproduct/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Coproduct</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../generic/product/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Product</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Integrations</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../integrations/rx2/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Rx2</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../integrations/reactor/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Reactor</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../integrations/kotlinxcoroutines/index.html">
                        <i class="fa fa-circle"></i>
                        <span>kotlinx.coroutines</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../integrations/retrofit/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Retrofit</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../integrations/kindedj/index.html">
                        <i class="fa fa-circle"></i>
                        <span>KindedJ</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Free</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../free/free/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Free</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../free/freeapplicative/index.html">
                        <i class="fa fa-circle"></i>
                        <span>FreeApplicative</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../free/cofree/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Cofree</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../free/yoneda/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Yoneda</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../free/coyoneda/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Coyoneda</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Recursion Schemes</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="index.html">
                        <i class="fa fa-circle"></i>
                        <span>Intro</span>
                    </a>
                </li>
                
                <li>
                    <a href="../recursive/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Recursive</span>
                    </a>
                </li>
                
                <li>
                    <a href="../corecursive/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Corecursive</span>
                    </a>
                </li>
                
                <li>
                    <a href="../birecursive/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Birecursive</span>
                    </a>
                </li>
                
                <li>
                    <a href="../mu/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Mu</span>
                    </a>
                </li>
                
                <li>
                    <a href="../nu/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Nu</span>
                    </a>
                </li>
                
                <li>
                    <a href="../fix/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Fix</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="index.html#">
                <span>Legal</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="../../legal/credits/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Credits</span>
                    </a>
                </li>
                
                <li>
                    <a href="../../legal/licenses/index.html">
                        <i class="fa fa-circle"></i>
                        <span>Licenses</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
    </ul>

</div>

    <div id="doc-wrapper">
    <div class="doc-header">
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <i class="fa fa-lg fa-bars menu-icon"></i>
        </button>
        <div class="search-wrapper">
          <input id="docsearch" class="search" placeholder="Search documentation..." type="search"/>
        </div>
        <a target="_blank" href="https://github.com/arrow-kt/arrow/edit/master/modules/docs/arrow-docs/docs/docs/recursion/intro/README.md">
          <i class="fa fa-pencil"></i>
            Edit
        </a>
    </div>
    <div class="doc-content">
        
        <h2 id="recursion-schemes">Recursion Schemes</h2>

<p class="advanced">advanced</p>

<p>Recursion schemes are an abstraction for structured recursion that ensure runtime safety and provide
powerful abstractions for recursive datatypes.</p>

<h4 id="arbitrary-recursion">Arbitrary recursion</h4>

<p>The traditional definition of a linked list uses arbitrary recursion.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// The generic type parameter is omitted for simplicity</span>
<span class="k">sealed</span> <span class="kd">class</span> <span class="nc">IntList</span> <span class="p">{</span>
  <span class="kd">object</span> <span class="nc">Nil</span> <span class="p">:</span> <span class="n">IntList</span><span class="p">()</span>
  <span class="kd">data class</span> <span class="nc">Cons</span><span class="p">(</span><span class="kd">val</span> <span class="py">head</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">tail</span><span class="p">:</span> <span class="n">IntList</span><span class="p">)</span> <span class="p">:</span> <span class="nc">IntList</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here, <code class="highlighter-rouge">Nil</code> is the empty list and <code class="highlighter-rouge">Cons</code> is an element plus another list. Instances of this can be created
by chaining <code class="highlighter-rouge">Cons</code> constructors.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">import</span> <span class="nn">arrow.*</span>
<span class="k">import</span> <span class="nn">arrow.core.*</span>
<span class="k">import</span> <span class="nn">arrow.typeclasses.*</span>
<span class="k">import</span> <span class="nn">arrow.recursion.*</span>

<span class="n">IntList</span><span class="p">.</span><span class="n">Cons</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Cons</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Cons</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Nil</span><span class="p">)))</span>
<span class="c1">// Cons(head=3, tail=Cons(head=2, tail=Cons(head=1, tail=Line_1$IntList$Nil@281259b4)))</span>
</code></pre></div></div>

<p>However, it would be nicer to have a function to do this for us. We can use arbitrary recursion to do this.
We&rsquo;ll call the function <code class="highlighter-rouge">downFrom</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">fun</span> <span class="nf">downFrom</span><span class="p">(</span><span class="nv">i</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">IntList</span> <span class="p">=</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Nil</span>
  <span class="k">else</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Cons</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">downFrom</span><span class="p">(</span><span class="n">i</span> <span class="p">-</span> <span class="m">1</span><span class="p">))</span>

<span class="n">downFrom</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="c1">// Cons(head=3, tail=Cons(head=2, tail=Cons(head=1, tail=Line_1$IntList$Nil@281259b4)))</span>
</code></pre></div></div>

<p>We can also use arbitrary recursion to do computation with this data structure. For example, we might want
to multiply every element in the list.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">fun</span> <span class="nf">multiply</span><span class="p">(</span><span class="nv">list</span><span class="p">:</span> <span class="nc">IntList</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span>
  <span class="k">when</span> <span class="p">(</span><span class="n">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">is</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Cons</span> <span class="p">-&gt;</span> <span class="n">list</span><span class="p">.</span><span class="n">head</span> <span class="p">*</span> <span class="n">multiply</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span>
    <span class="n">IntList</span><span class="p">.</span><span class="n">Nil</span> <span class="p">-&gt;</span> <span class="m">1</span>
  <span class="p">}</span>

<span class="n">multiply</span><span class="p">(</span><span class="n">downFrom</span><span class="p">(</span><span class="m">3</span><span class="p">))</span>
<span class="c1">// 6</span>
</code></pre></div></div>

<p>Both the <code class="highlighter-rouge">downFrom</code> and <code class="highlighter-rouge">multiply</code> functions are arbitrarily recursive functions; they both call themselves
in their definition. <code class="highlighter-rouge">IntList</code> itself is an arbitrarily recursive type for the same reason. However, there
is a problem with arbitrary recursion: it is impossible to guarantee that an arbitrarily recursive function
is stack safe.</p>

<h4 id="folds-and-unfolds">Folds and unfolds</h4>

<p><code class="highlighter-rouge">fold</code> is a familiar function to most functional programmers, and is used whenever a collection needs to be
collapsed into a single element. The <code class="highlighter-rouge">multiply</code> function above can be implemented much more simply using <code class="highlighter-rouge">fold</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">fold</span><span class="p">(</span><span class="nv">list</span><span class="p">:</span> <span class="nc">IntList</span><span class="p">,</span> <span class="nv">onNil</span><span class="p">:</span> <span class="nc">A</span><span class="p">,</span> <span class="n">onCons</span><span class="p">:</span> <span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="nc">A</span> <span class="p">=</span>
  <span class="k">when</span> <span class="p">(</span><span class="n">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">is</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Cons</span> <span class="p">-&gt;</span> <span class="n">onCons</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="n">head</span><span class="p">,</span> <span class="n">fold</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="n">tail</span><span class="p">,</span> <span class="n">onNil</span><span class="p">,</span> <span class="n">onCons</span><span class="p">))</span>
    <span class="n">IntList</span><span class="p">.</span><span class="n">Nil</span> <span class="p">-&gt;</span> <span class="n">onNil</span>
  <span class="p">}</span>

<span class="k">fun</span> <span class="nf">multiply</span><span class="p">(</span><span class="nv">list</span><span class="p">:</span> <span class="nc">IntList</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">fold</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">-&gt;</span> <span class="n">a</span> <span class="p">*</span> <span class="n">b</span> <span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">unfold</code> is the less commonly known opposite of fold; it takes in an initial element and generates a
collection (you may recognize it as the <code class="highlighter-rouge">generateT</code> functions in the kotlin standard library). The
<code class="highlighter-rouge">downFrom</code> function can be implemented much more simply using <code class="highlighter-rouge">unfold</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">unfold</span><span class="p">(</span><span class="nv">init</span><span class="p">:</span> <span class="nc">A</span><span class="p">,</span> <span class="n">produce</span><span class="p">:</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;&gt;):</span> <span class="nc">IntList</span> <span class="p">=</span>
  <span class="n">produce</span><span class="p">(</span><span class="n">init</span><span class="p">).</span><span class="n">fold</span><span class="p">(</span>
    <span class="p">{</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Nil</span> <span class="p">},</span>
    <span class="p">{</span> <span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">IntList</span><span class="p">.</span><span class="n">Cons</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">unfold</span><span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">produce</span><span class="p">))</span> <span class="p">}</span>
  <span class="p">)</span>

<span class="k">fun</span> <span class="nf">downFrom</span><span class="p">(</span><span class="nv">i</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">IntList</span> <span class="p">=</span>
  <span class="n">unfold</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="p">-&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span> <span class="n">None</span>
    <span class="k">else</span> <span class="n">Some</span><span class="p">(</span><span class="n">x</span> <span class="n">toT</span> <span class="p">(</span><span class="n">x</span> <span class="p">-</span> <span class="m">1</span><span class="p">))</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>The new implementations of <code class="highlighter-rouge">downFrom</code> and <code class="highlighter-rouge">multiply</code> use structured recursion. Here, <code class="highlighter-rouge">fold</code> and <code class="highlighter-rouge">unfold</code> are
actually recursion schemes; they abstract out the recursion from the business logic of the function. Though
the implementations above are not stack safe, they can easily be made so (at the cost of some readability),
and any functions implemented with them would also become stack safe.</p>

<h4 id="generalized-folds-and-unfolds">Generalized folds and unfolds</h4>

<p>Lists are not the only data structure that can be folded and unfolded. Binary trees can also use this
pattern.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">sealed</span> <span class="kd">class</span> <span class="nc">IntTree</span> <span class="p">{</span>
  <span class="kd">data class</span> <span class="nc">Leaf</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">:</span> <span class="nc">IntTree</span><span class="p">()</span>
  <span class="kd">data class</span> <span class="nc">Node</span><span class="p">(</span><span class="kd">val</span> <span class="py">left</span><span class="p">:</span> <span class="n">IntTree</span><span class="p">,</span> <span class="kd">val</span> <span class="py">right</span><span class="p">:</span> <span class="n">IntTree</span><span class="p">)</span> <span class="p">:</span> <span class="nc">IntTree</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">fold</span><span class="p">(</span><span class="nv">tree</span><span class="p">:</span> <span class="nc">IntTree</span><span class="p">,</span> <span class="n">onLeaf</span><span class="p">:</span> <span class="p">(</span><span class="n">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">A</span><span class="p">,</span> <span class="n">onNode</span><span class="p">:</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">A</span><span class="p">):</span> <span class="nc">A</span> <span class="p">=</span>
  <span class="k">when</span> <span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">is</span> <span class="n">IntTree</span><span class="p">.</span><span class="n">Leaf</span> <span class="p">-&gt;</span> <span class="n">onLeaf</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">is</span> <span class="n">IntTree</span><span class="p">.</span><span class="n">Node</span> <span class="p">-&gt;</span> <span class="n">onNode</span><span class="p">(</span><span class="n">fold</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">onLeaf</span><span class="p">,</span> <span class="n">onNode</span><span class="p">),</span> <span class="n">fold</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">right</span><span class="p">,</span> <span class="n">onLeaf</span><span class="p">,</span> <span class="n">onNode</span><span class="p">))</span>
  <span class="p">}</span>

<span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;</span> <span class="nf">unfold</span><span class="p">(</span><span class="nv">init</span><span class="p">:</span> <span class="nc">A</span><span class="p">,</span> <span class="n">produce</span><span class="p">:</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Either</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;&gt;):</span> <span class="nc">IntTree</span> <span class="p">=</span>
  <span class="n">produce</span><span class="p">(</span><span class="n">init</span><span class="p">).</span><span class="n">fold</span><span class="p">(</span>
    <span class="p">{</span> <span class="n">IntTree</span><span class="p">.</span><span class="n">Leaf</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">},</span>
    <span class="p">{</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">IntTree</span><span class="p">.</span><span class="n">Node</span><span class="p">(</span><span class="n">unfold</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">produce</span><span class="p">),</span> <span class="n">unfold</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">produce</span><span class="p">))</span> <span class="p">}</span>
  <span class="p">)</span>
</code></pre></div></div>

<p>In fact, <code class="highlighter-rouge">fold</code> and <code class="highlighter-rouge">unfold</code> can be implemented for any recursive data structure, even complex ones like
expression trees. However, it requires a lot of boilerplate and creates a lot of complexity. Luckily for us,
Arrow&rsquo;s recursion schemes allow us to solve this problem.</p>

<h4 id="recursive-type-parameters">Recursive type parameters</h4>

<p>The solution to this initially seems a bit strange. First, we must define a type&rsquo;s pattern, where
the recursive type is replaced with a type parameter.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@higherkind</span> <span class="k">sealed</span> <span class="kd">class</span> <span class="nc">IntListPattern</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IntListPatternOf</span><span class="p">&lt;</span><span class="n">A</span><span class="p">&gt;</span> <span class="p">{</span> 
  <span class="kd">object</span> <span class="nc">NilPattern</span> <span class="p">:</span> <span class="n">IntListPattern</span><span class="p">&lt;</span><span class="n">Nothing</span><span class="p">&gt;()</span>
  <span class="nd">@higherkind</span> <span class="kd">data class</span> <span class="nc">ConsPattern</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">A</span><span class="p">&gt;(</span><span class="kd">val</span> <span class="py">head</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">tail</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="p">:</span> <span class="nc">IntListPattern</span><span class="p">&lt;</span><span class="nc">A</span><span class="p">&gt;()</span>
  <span class="k">companion</span> <span class="k">object</span> 
<span class="p">}</span>
<span class="k">fun</span> <span class="nc">IntListPattern</span><span class="p">.</span><span class="nc">Companion</span><span class="p">.</span><span class="nf">functor</span><span class="p">():</span> <span class="nc">IntListPatternFunctor</span> <span class="p">=</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">IntListPatternFunctor</span><span class="p">{}</span>
</code></pre></div></div>

<p>While this type may look useless at first, it turns out that our original <code class="highlighter-rouge">IntList</code> and <code class="highlighter-rouge">IntListPattern&lt;IntList&gt;</code>
are isomorphic &ndash; that is, they can easily be converted from one to another. For that matter, <code class="highlighter-rouge">IntList</code> is
also isomorphic to <code class="highlighter-rouge">IntListPattern&lt;IntListPattern&lt;IntList&gt;&gt;</code>. In fact, applying <code class="highlighter-rouge">IntListPattern</code> to itself
infinitely yields the original <code class="highlighter-rouge">IntList</code> type.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typealias</span> <span class="n">IntList</span> <span class="p">=</span> <span class="n">IntListPattern</span><span class="p">&lt;</span><span class="n">IntListPattern</span><span class="p">&lt;</span><span class="n">IntListPattern</span><span class="p">&lt;</span><span class="o">..</span><span class="p">.&gt;&gt;&gt;</span>
</code></pre></div></div>

<p>Of course, this is not possible in Kotlin. However, we can use the <code class="highlighter-rouge">Fix</code> datatype (a type level recursion scheme)
to emulate this.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">import</span> <span class="nn">arrow.recursion.data.*</span>

<span class="k">typealias</span> <span class="n">IntFixList</span> <span class="p">=</span> <span class="n">Fix</span><span class="p">&lt;</span><span class="n">ForIntListPattern</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>So why do this? We can now define a <a href="https://next.arrow-kt.io/docs/arrow/typeclasses/functor">Functor</a> instance for 
<code class="highlighter-rouge">IntListPattern</code>, allowing us to traverse into the structure.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">interface</span> <span class="nc">IntListPatternFunctor</span> <span class="p">:</span> <span class="n">Functor</span><span class="p">&lt;</span><span class="n">ForIntListPattern</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">A</span><span class="p">,</span> <span class="nc">B</span><span class="p">&gt;</span> <span class="nf">IntListPatternOf</span><span class="p">&lt;</span><span class="n">A</span><span class="p">&gt;.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">B</span><span class="p">):</span> <span class="nc">IntListPatternOf</span><span class="p">&lt;</span><span class="nc">B</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">lp</span> <span class="p">=</span> <span class="n">fix</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">lp</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">is</span> <span class="n">ConsPattern</span><span class="p">&lt;</span><span class="n">A</span><span class="p">&gt;</span> <span class="p">-&gt;</span> <span class="n">IntListPattern</span><span class="p">.</span><span class="n">ConsPattern</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">head</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">tail</span><span class="p">))</span>
      <span class="k">is</span> <span class="n">NilPattern</span> <span class="p">-&gt;</span> <span class="n">IntListPattern</span><span class="p">.</span><span class="n">NilPattern</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This can be used to implement <code class="highlighter-rouge">fold</code> and <code class="highlighter-rouge">unfold</code> for any <code class="highlighter-rouge">Fix&lt;F&gt;</code>, where <code class="highlighter-rouge">F</code> is a <code class="highlighter-rouge">Functor</code> (and hence
for any recursive data structure) by using <code class="highlighter-rouge">map</code> to recursively descend into the structure.</p>

<h4 id="recursive-and-corecursive">Recursive and Corecursive</h4>

<p>The <a href="https://next.arrow-kt.io/docs/recursion/recursive">Recursive</a> typeclass provides <code class="highlighter-rouge">cata</code>, and the 
<a href="https://next.arrow-kt.io/docs/recursion/recursive">Corecursive</a> typeclass provides <code class="highlighter-rouge">ana</code>, which are very
similar to fold and unfold.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">typealias</span> <span class="n">Algebra</span><span class="p">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">=</span> <span class="p">(</span><span class="n">Kind</span><span class="p">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">A</span>     <span class="c1">// fold</span>
<span class="k">typealias</span> <span class="n">Coalgebra</span><span class="p">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">=</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Kind</span><span class="p">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span>   <span class="c1">// unfold</span>

<span class="k">fun</span> <span class="p">&lt;</span><span class="nc">F</span><span class="p">,</span> <span class="nc">A</span><span class="p">&gt;</span> <span class="nf">Functor</span><span class="p">&lt;</span><span class="n">F</span><span class="p">&gt;.</span><span class="n">cata</span><span class="p">(</span><span class="nv">f</span><span class="p">:</span> <span class="nc">Fix</span><span class="p">&lt;</span><span class="nc">F</span><span class="p">&gt;,</span> <span class="nv">alg</span><span class="p">:</span> <span class="nc">Algebra</span><span class="p">&lt;</span><span class="nc">F</span><span class="p">,</span> <span class="nc">Eval</span><span class="err">&lt;</span><span class="nc">A</span><span class="p">&gt;&gt;):</span> <span class="nc">A</span> <span class="p">=</span> <span class="n">TODO</span><span class="p">()</span>
<span class="k">fun</span> <span class="p">&lt;</span><span class="nc">F</span><span class="p">,</span> <span class="nc">A</span><span class="p">&gt;</span> <span class="nf">Functor</span><span class="p">&lt;</span><span class="n">F</span><span class="p">&gt;.</span><span class="n">ana</span><span class="p">(</span><span class="nv">a</span><span class="p">:</span> <span class="nc">A</span><span class="p">,</span> <span class="nv">coalg</span><span class="p">:</span> <span class="nc">Coalgebra</span><span class="p">&lt;</span><span class="nc">F</span><span class="p">,</span> <span class="nc">A</span><span class="p">&gt;):</span> <span class="nc">Fix</span><span class="p">&lt;</span><span class="nc">F</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">TODO</span><span class="p">()</span>
</code></pre></div></div>

<p>We can use them to rewrite our <code class="highlighter-rouge">multiply</code> and <code class="highlighter-rouge">downFrom</code> functions.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">import</span> <span class="nn">arrow.recursion.extensions.fix.recursive.*</span>

<span class="c1">// We extract these functions out for later use</span>
<span class="kd">val</span> <span class="py">multiply</span><span class="p">:</span> <span class="n">Algebra</span><span class="p">&lt;</span><span class="n">ForIntListPattern</span><span class="p">,</span> <span class="n">Eval</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;&gt;</span> <span class="p">=</span> <span class="p">{</span> <span class="n">l</span> <span class="p">-&gt;</span>
  <span class="kd">val</span> <span class="py">list</span> <span class="p">=</span> <span class="n">l</span><span class="p">.</span><span class="n">fix</span><span class="p">()</span>
  <span class="k">when</span> <span class="p">(</span><span class="n">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">is</span> <span class="n">ConsPattern</span><span class="p">&lt;</span><span class="n">Eval</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;&gt;</span> <span class="p">-&gt;</span> <span class="n">list</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="n">list</span><span class="p">.</span><span class="n">head</span> <span class="p">}</span>
    <span class="k">is</span> <span class="n">NilPattern</span> <span class="p">-&gt;</span> <span class="n">Eval</span><span class="p">.</span><span class="n">now</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">downFrom</span><span class="p">:</span> <span class="n">Coalgebra</span><span class="p">&lt;</span><span class="n">ForIntListPattern</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">-&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span> <span class="n">IntListPattern</span><span class="p">.</span><span class="n">NilPattern</span>
  <span class="k">else</span> <span class="p">(</span><span class="n">i</span> <span class="p">-</span> <span class="m">1</span><span class="p">).</span><span class="n">let</span> <span class="p">{</span> <span class="n">IntListPattern</span><span class="p">.</span><span class="n">ConsPattern</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">multiply</span><span class="p">(</span><span class="nv">list</span><span class="p">:</span> <span class="nc">IntFixList</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">Fix</span><span class="p">.</span><span class="n">recursive</span><span class="p">().</span><span class="n">run</span> <span class="p">{</span>
  <span class="n">IntListPattern</span><span class="p">.</span><span class="n">functor</span><span class="p">().</span><span class="n">cata</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">multiply</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">downFrom</span><span class="p">(</span><span class="nv">i</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">IntFixList</span> <span class="p">=</span> <span class="n">Fix</span><span class="p">.</span><span class="n">recursive</span><span class="p">().</span><span class="n">run</span> <span class="p">{</span>
  <span class="n">IntListPattern</span><span class="p">.</span><span class="n">functor</span><span class="p">().</span><span class="n">ana</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">downFrom</span><span class="p">).</span><span class="n">fix</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="general-recursion">General recursion</h4>

<p>So far, we&rsquo;ve generalized <code class="highlighter-rouge">fold</code> and <code class="highlighter-rouge">unfold</code> into <code class="highlighter-rouge">cata</code> and <code class="highlighter-rouge">ana</code> which are recursion schemes for
destroying and creating any recursive structure. By combining these, we can create a recursion scheme for
general recursion.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">fun</span> <span class="nf">factorial</span><span class="p">(</span><span class="nv">i</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">IntListPattern</span><span class="p">.</span><span class="n">functor</span><span class="p">().</span><span class="n">hylo</span><span class="p">(</span><span class="n">multiply</span><span class="p">,</span> <span class="n">downFrom</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</code></pre></div></div>

<p>Here we use the <code class="highlighter-rouge">IntListPattern</code> functor to model recursion which resembles a stack; we unfold a list as
we traverse deeper into the call structure, then fold a list as we evaluate the result. This allows us
to effectively model any recursive computation with recursion schemes, making them consistant and stack
safe.</p>

<h4 id="typeclasses">Typeclasses</h4>

<ul>
  <li><a href="https://next.arrow-kt.io/docs/recursion/recursive">Recursive</a></li>
  <li><a href="https://next.arrow-kt.io/docs/recursion/recursive">Corecursive</a></li>
  <li><a href="https://next.arrow-kt.io/docs/recursion/recursive">Birecursive</a></li>
</ul>

<h4 id="datatypes">Datatypes</h4>

<ul>
  <li><a href="https://next.arrow-kt.io/docs/recursion/fix">Fix</a></li>
  <li><a href="https://next.arrow-kt.io/docs/recursion/mu">Mu</a></li>
  <li><a href="https://next.arrow-kt.io/docs/recursion/nu">Nu</a></li>
</ul>

<h2 id="credits">Credits</h2>

<p>Tutorial partially adapted from <a href="https://www.youtube.com/watch?v=XZ9nPZbaYfE">Peeling the Banana: Recursion Schemes from First Principles by Zainab Ali</a></p>

<p>Contents partially adapted from <a href="https://github.com/aedans/Katalyst.git">Katalyst</a></p>

    </div>
</div>

</div>
<!-- Jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- Arrow playground -->
<script src="https://unpkg.com/arrow-playground@1" data-selector="[class^=&#39;language-kotlin&#39;]"></script>
<!-- Highlight -->
<script src="../../../js/highlight.pack.js"></script>
<script>
  hljs.initHighlighting();
</script>
<!-- Docsearch -->
<script type="text/javascript" src="../../../js/docsearch.min.js"></script>
<!-- Custom scripts for this template -->
<script src="../../../js/functions.js"></script>
<!-- Gitter -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'arrow-kt/Lobby'
  };

</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script>



</body></html>